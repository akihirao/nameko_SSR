#PCO_Phmi.R
#from 2018,10.10

...{r}
library(polysat)
library(hierfstat)
library(maptools)
library(adegenet)
library(RColorBrewer)
...


#par(mfrow=c(1,2))

Nameko.SSR.table <- read.table("./data/Phmi_genotypes_CVs.3digits.dat", header=TRUE)
Nameko.SSR.genind <- df2genind(Nameko.SSR.table[,-c(1:3)],ploidy=2,ncode=3,ind.name=Nameko.SSR.table$Sample,pop=Nameko.SSR.table$Pop)

no.wild.pop <- length(unique(Nameko.SSR.genind@pop)) -1 

pinfreps <- c(3,2,3,2,2,2,2,3,3,3,2,2,3,2)


#fellfield.col <- rgb(235/255,50/255,50/255)
#snowbed.col <- rgb(0/255,150/255,241/255)

#col=funky(15)
#col.palett.pre <- brewer.pal(11,"Spectral")
#col.palett <- c(rep(col.palett[11],10),rep(col.palett[11],20),rep(col.palett[10],20)ß,col.palett[9],col.palett[10],col.palett[9],col.palett[8],col.palett[7],col.palett[7],col.palett[6],col.palett[6], col.palett[4],col.palett[4],col.palett[2],col.palett[2])
#col[c(1,3,4,8,10,12,14)] <- fellfield.col
#col[c(2,5,6,7,9,11,13,15)] <- snowbed.col


#pch.marker <- c(rep(16,10),rep(1,20),rep(16,20),rep(16,20),rep(1,20),rep(1,20),rep(1,20),rep(16,20),rep(1,20),rep(16,20),rep(1,20),rep(15,30),rep(0,30),rep(15,30),rep(0,30))

pca.Nameko <- dudi.pca(Nameko.SSR.genind, 
	scale=FALSE, scannf=FALSE, nf=3)
pca.Nameko.contribute.1<-pca.Nameko$eig[1]/sum(pca.Nameko$eig)
pca.Nameko.contribute.2<-pca.Nameko$eig[2]/sum(pca.Nameko$eig)
pca.Nameko.contribute.3<-pca.Nameko$eig[3]/sum(pca.Nameko$eig)
print(c(pca.Nameko.contribute.1,pca.Nameko.contribute.2,pca.Nameko.contribute.3))

#scatter(pca.Gastrodia)
if(FALSE){
s.class(pca.Nameko$li,pop(Nameko.SSR.genind),
	#col=transp(col,1), 
	cpoint=1.2, grid=FALSE,
	#label=NULL,
#	col=col,
#	clabel=0.6,
#	pch=pch.marker)
)
}


no.pop <- length(unique(pop(Nameko.SSR.genind)))

#種判別のカラーを定義する

col.wild =funky(no.wild.pop)
col.wild.cultivar <- c(col.wild,"black")

cols1 <- brewer.pal(8, "Set1") #Set1の最初から8番目までの色を取り込みます。
cols2 <- brewer.pal(7, "Pastel1")　#Pastel1の最初から7番目までの色を取り込みます。
cols <- c(cols1, cols2) 
cols.plot <- cols[1:no.pop]
#cols <- brewer.pal(no.pop, "Paired")

s.class(pca.Nameko$li,pop(Nameko.SSR.genind),
	xax=1, yax=2,
	col=transp(col.wild.cultivar,0.6),
	axesell=FALSE,
	#cstar=0,
	cpoint=3, grid=FALSE)
#add.scatter.eig(pca.Nameko$eig[1:18], 3,1,2)


if(FALSE){
s.class(pca.Nameko$li,pop(Nameko.SSR.genind),
	xax=1, yax=3,
	col=cols.plot,
	#col=transp(cols.plot, .6),
	axesell=FALSE,
	#cstar=0,
	cpoint=3, grid=FALSE)
add.scatter.eig(pca.Nameko$eig[1:18], 3,1,3)
}



if(FALSE){
colorplot(pca.Nameko$li, pca.Nameko$li, transp=TRUE, cex=3, xlab="PC 1", ylab="PC 2")
abline(v=0,h=0,col="grey", lty=2)
}

